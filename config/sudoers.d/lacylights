# LacyLights Service Permissions
#
# This file grants the lacylights user permission to execute specific commands
# without requiring a password for:
# - WiFi configuration via NetworkManager (nmcli)
# - Service management for updates (systemctl)
# - Repository updates and filesystem remounting
#
# IMPORTANT: This file must be installed to /etc/sudoers.d/lacylights with:
#   sudo cp lacylights /etc/sudoers.d/
#   sudo chmod 0440 /etc/sudoers.d/lacylights
#   sudo chown root:root /etc/sudoers.d/lacylights
#
# These permissions allow the LacyLights web interface to:
# - Scan for available WiFi networks
# - Connect to WiFi networks
# - Disconnect from WiFi networks
# - Enable/disable the WiFi radio
# - Manage saved network connections
# - Update LacyLights components (stop/start services)
#
# Security Note: These commands are limited to specific LacyLights services
# and do not grant broader system access. The lacylights service runs as a
# dedicated user with limited privileges.

# Allow WiFi device management
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli device wifi *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli device set wlan* *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli device status

# Allow WiFi connection management
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection up *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection down *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection delete *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection show *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection add *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli connection modify *

# Allow WiFi radio control
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli radio wifi *
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli radio all *

# Allow general network status queries (read-only)
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli general status
lacylights ALL=(ALL) NOPASSWD: /usr/bin/nmcli networking connectivity

# Allow repository updates via wrapper script (handles read-only filesystem remounting)
lacylights ALL=(ALL) NOPASSWD: /opt/lacylights/scripts/update-repos-wrapper.sh *

# Allow filesystem remounting for updates (used by wrapper script)
lacylights ALL=(ALL) NOPASSWD: /usr/bin/mount -o remount\,rw /
lacylights ALL=(ALL) NOPASSWD: /usr/bin/mount -o remount\,ro /

# Allow service management for updates (stop/start/restart LacyLights services)
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop lacylights
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl start lacylights
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart lacylights
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl is-active lacylights
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl is-active --quiet lacylights
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop lacylights-frontend
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl start lacylights-frontend
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart lacylights-frontend
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl is-active lacylights-frontend
lacylights ALL=(ALL) NOPASSWD: /usr/bin/systemctl is-active --quiet lacylights-frontend

# Allow chown for setting file ownership during updates
lacylights ALL=(ALL) NOPASSWD: /usr/bin/chown lacylights\:lacylights *
